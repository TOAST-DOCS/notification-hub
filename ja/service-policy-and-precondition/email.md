<style>
.page__rnb .lst_rnb_item .rnb_item:first-of-type a {
    display: inline !important;
}
</style>
<h1>Email</h1>

**Notification > Notification Hub > 利用ポリシー及び事前設定案内 > Email**

## 発信ドメインとDNS TXTレコードの登録

Notification Hubでメールを送信するには、自分が所有している送信ドメインが必要です。各ユーザーが自分のドメインを通じて送信者の身元を認証し、メールがスパムに分類されないようにするためです。送信ドメインを通じてSPF、DKIM、DMARCなどの認証設定を適用して、メールの信頼性を高めることができます。これにより、メールが受信者のメールボックスに安全に届き、フィッシングやなりすましを防止できます。Notification Hubのメール送信(SMTP)サーバーを通じて、ユーザー所有のドメインが含まれたメールアドレスとともにメールが受信サーバー(SMTP)に送信されます。メール受信サーバーがNotification Hubメール送信サーバーを信頼するためには、ユーザー所有のドメインがサービスされているDNSにSPF、DKIM、DMARC TXTレコードの設定が必要です。

### 注意事項

* Notification Hubは、メールの返送率が過度に高い場合、サービスの運営ポリシーにより送信が制限される場合があります。
    * 返送率とは、顧客が送信を要求したメールアドレスのうち、受信SMTPサーバーからメールを転送できない(返送または送信失敗率)と伝達されたメールアドレスの割合です。
* 過度のメール返送率が発生しないように管理してください。
* 返送率(返送または送信失敗)が発生する原因は次のとおりです。
    * 無効な発信者メールアドレスまたは発信ドメイン
    * 無効な受信者メールアドレスまたは受信ドメイン
    * SPF, DKIM, DMARCなどのメールセキュリティ対策が適用されていない送信ドメイン。
    * 同じ受信者が過度に繰り返されたり、重複したメールを送信する場合。
    * 受信拒否を回避するために操作されたメールを送信する場合
    * フィッシングやスパムと疑われるような内容を含むメールを送信する場合
    * 情報通信網法ガイドを守っていない広告性メールを送信する場合
* 返送率によりメール送信が制限された場合、返送が発生する原因に該当する事項があるかどうかを確認し、改善措置を行ってください。
    * その後、 [サポート > 1:1お問い合わせ](https://www.nhncloud.com/kr/support/inquiry)から送信制限の解除をお問い合わせください。

### SPF

SPF(sender policy framework、送信者ポリシーフレームワーク)は、メール送信時に許可されたサーバーのリストを定義し、送信ドメインを偽造したスパムメールやフィッシング攻撃を防止する認証メカニズムです。送信ドメインのDNSにSPFレコードを追加すると、メール受信サーバーは、そのリストに含まれるサーバーからメールが送信されたことを認証できます。これにより、メール送信サーバーの信頼性を高め、メールがスパムに分類されないようにします。

* [Emailセキュリティ強化機能紹介(SPF)](https://meetup.nhncloud.com/posts/244)

### DKIM, DMARC

DKIM(domainKeys identified mail,ドメインキー識別メール)は、メールにデジタル署名を追加して送信ドメインが偽造されていないことを証明する認証方法です。メール送信サーバーは署名を含むメールヘッダを追加し、メール受信サーバーは送信ドメインの公開鍵を通じて署名の有効性を確認します。これにより、メールが送信中に改ざんされていないことを確認することができ、送信者及びメール送信サーバーの信頼性を高めます。

DMARC(domain-based message authentication, reporting, and conformance(ドメインベースメッセージ認証、報告、及び適合性)は、SPFとDKIMをベースにメール認証を強化し、認証に失敗したメールがどのように処理されるかをポリシーで定義する方法です。ドメイン所有者は、DMARCを通じ、メール受信サーバーで認証失敗が発生した場合、メールをどのように処理するかポリシー(拒否、隔離、許可)を提供します。DMARCはまた、レポート機能を通じて、メール受信サーバーから認証失敗事例についてレポートメールを受け取ることができ、これを分析してドメイン保護を強化できます。

* [メールセキュリティ強化機能紹介(ドメイン保護、 DKIM, DMARC) ](https://meetup.nhncloud.com/posts/248)

## Gmail関連案内事項

### GmailとYahooのメール受信基準強化

2024年2月1日からGmailとYahooのメール送信者ガイドラインが変更され、ドメイン認証及びSPF、DKIM、DMARC認証を行わない場合、一部の受信するメールシステムに対する送信リクエストが拒否される可能性があります。これにより、Notification HubでSPF、DKIM、DMARC認証を完了していない送信ドメインは、Gmail、Yahooへの送信が失敗処理されます。

* [Gmail * Email Sender Guidelines](https://support.google.com/a/answer/81126)
* [Yahoo * Sender Requirements & Recommanations](https://senders.yahooinc.com/best-practices/)

#### SPF, DKIM, DMARC未認証の場合の送信制限対象ドメイン
* gmail.com
* yahoo.com

Gmailは、ドメインの評判をスパムメール判定の主な基準としています。低いドメインの評判を持つ送信者が高速で大量のメールを送信したり、受信者が望まない広告性メールを送信すると、受信者の「受信トレイ」に保存しますが、警告を表示したり、「スパムメールボックス」に保存したり、さらに受信速度を制限したり、受信を拒否することがあります。したがって、メールを大量に送信しようとする場合は、次のガイドのドメイン評判管理方法を参考にして、常にドメインの評判を高く維持するように気をつけなければなりません。

### Gmail閲覧済みのイベント収集不可案内

受信者のメールがGmailの場合、メールの閲覧の有無を収集できません。一般的に受信者のメール閲覧を確認するためにメール本文に画像タグを挿入する方式を使用しますが、Gmailでは画像プロキシサーバーが画像をキャッシュして追跡できないようにメール本文を修正します。これはGmailが意図的にブロックしているため、技術的に閲覧に関するイベントを収集することは現在不可能です。

### Gmail低い評判(Low Reputation)問題

Gmail評判評価基準について簡単にまとめたガイドです。Gmailで評判を評価する方法を見て、評判を上げて維持するための方法は何なのかについて説明します詳細な内容は文書下の参考文書をご確認ください。

#### 評判(Reputation)とは？
メール送信時、ISP(inbox service provider、Gmail、受信SMPTサーバー)は送信SMTPサーバーの評判を評価し、受信可否を決め、スパムを分類します。ISPの評判評価方式に合わないメールを送信すると、送信速度が低下したり、そのISPを使用する受信者のメール受信が困難になる可能性があります。

評判には大きくIP評判、ドメイン評判があります。
* IP評判：IPは送信SMTPのIPです。送信SMTPが持つIPの評判を意味します。
* ドメイン評判：ドメインはメール送信ドメインです。NHNのドメインは「nhn.com」になります。メール送信の主体となるドメインの評判を意味します。

#### Gmailの評判評価方式
* ドメインの評判をより重要に評価：複数のドメインがIPを共有して送信する場合が多いので、IPよりドメインをより重要に評価します。Complaints(苦情)よりEngagement(参加)をより重要に評価します。ここでComplaintsは受信者のスパム処理などを意味します。Engagementは、受信者がメール内容を確認し、内容にあるリンクをクリックし、スパム処理を解除することなどを意味します。
* その他の評価項目：個人的なメールかどうか、送信IPの評判はどうか、メール内にリンクが含まれているかどうか、メールの内容など、様々な要素を評価して評判を決定します。

#### 評判を上げる方法
* 準備(warm-up)過程が必要：最初から新しいIPとドメインで大量のメールを送信することは望ましくなく、むしろ評判が下がる可能性があります。数日かけて50、100、500、1000…のように徐々に増加させる必要があります。
* 参加度(Engagement)が高い受信者に送信: Gmailに送信したメールが受信者が望むものであることを証明する必要があります。準備過程で一般的なユーザーよりはるかにサービス参加度と忠誠度が高く、メールが来るのを待っているユーザーに送信すると、評判を簡単に高めることができます。
* 受信拒否機能を提供：サービスで受信するかどうかを設定できるように機能を提供する必要があります。ワンクリック受信拒否(One-Click Unsubscribe)やメール下部に受信拒否リンクを提供することが評判の向上に役立ちます。
* 受信者に適合性(Relevancy)の高いメールを送信:評判を維持するためには、メール内容と関連性のある対象者に送信する必要があります。単にメールを頻繁に送るよりも重要です。送信対象の大きさは重要ではありません。メール内容と対象を細分化して送信する必要があります。購読解除の原因の66%は関連性のないメール、55%はメッセージの疲労度によるものです。

#### 評判に関する外部資料参照
* [Mailgun * Domain Reputation Or IP Reputation: Which One Does Gmail Care About More?](https://www.mailgun.com)
